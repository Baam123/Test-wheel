<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VÃ²ng Quay May Máº¯n ITC</title>
  <link rel="stylesheet" href="css/typo/typo.css" />
  <link rel="stylesheet" href="css/hc-canvas-luckwheel.css" />
  <link rel="stylesheet" href="css/custom-styles.css" />

  <link href="./images/hengaplai.png" rel="icon" type="image/x-icon" />
</head>

<body class="bg">
  <div id="content" class="container">
    <div id="post">
      <div class="wrapper typo" id="wrapper">
        <section id="luckywheel" class="hc-luckywheel">
          <div class="hc-luckywheel-container">
            <canvas class="hc-luckywheel-canvas" width="500" height="500">VÃ²ng Xoay May Máº¯n</canvas>
          </div>
          <a class="hc-luckywheel-btn" href="javascript:;">Xoay</a>
        </section>
      </div>
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
      <script src="js/hc-canvas-luckwheel.js"></script>
      <script>
        var isPercentage = true;
        // Tá»•ng xÃ¡c suáº¥t = 1.0 chÃ­nh xÃ¡c
        var prizes = [
          {
            text: "ChÃ o má»«ng báº¡n Ä‘áº¿n vá»›i ITC",
            img: "images/hengaplai.png",
            percentpage: 0.45
          },
          {
            text: "Chuá»™t Bluetooth",
            img: "images/chuot2.png",
            percentpage: 0.02
          },
          {
            text: "BÃ¬nh nÆ°á»›c",
            img: "images/binh.png",
            percentpage: 0.02
          },
          {
            text: "USB 3.2 Kingston",
            img: "images/usb.png",
            percentpage: 0.02
          },
          {
            text: "ChÃ o má»«ng báº¡n Ä‘áº¿n vá»›i ITC",
            img: "images/hengaplai.png",
            percentpage: 0.45
          },
          {
            text: "Gáº¥u bÃ´ng",
            img: "images/gaubong.png",
            percentpage: 0.04
          },
          {
            text: "QuÃ  bÃ­ áº©n",
            img: "images/gift_Y.png",
            percentpage: 0.00
          },
          {
            text: "Balo ITC",
            img: "images/balo1.png",
            percentpage: 0.00
          },
        ];

        // Kiá»ƒm tra tá»•ng xÃ¡c suáº¥t
        const totalProbability = prizes.reduce((sum, p) => sum + p.percentpage, 0);
        console.log("âœ… Tá»•ng xÃ¡c suáº¥t:", totalProbability.toFixed(2));

        const Toast = Swal.mixin({
          toast: true,
          position: 'center',
          showConfirmButton: false,
          timer: 8000,
          timerProgressBar: true,
          background: 'rgba(255, 255, 255, 0)',
          backdrop: false,
        });

        document.addEventListener(
          "DOMContentLoaded",
          function () {
            hcLuckywheel.init({
              id: "luckywheel",
              config: function (callback) {
                callback && callback(prizes);
              },
              mode: "both",
              getPrize: function (callback) {
                var rand = randomIndex(prizes);
                var chances = rand;
                callback && callback([rand, chances]);
              },
              gotBack: function (data, index) {
                console.log("=== GOTBACK CALLED ===");
                console.log("Raw data:", data);
                console.log("Index:", index);

                // Táº®T TOÃ€N Bá»˜ SWEETALERT Tá»ª THÆ¯ VIá»†N
                const originalSwal = window.Swal;
                window.Swal = {
                  fire: function () {
                    console.log("Swal.fire blocked from library");
                    return Promise.resolve();
                  }
                };

                // Láº¥y thÃ´ng tin prize
                let prizeText = '';
                let prizeImg = '';

                if (typeof index === 'number' && prizes[index]) {
                  prizeText = prizes[index].text;
                  prizeImg = prizes[index].img;
                } else if (typeof data === 'string') {
                  prizeText = data;
                  let foundPrize = prizes.find(p => p.text === data);
                  prizeImg = foundPrize ? foundPrize.img : '';
                }

                console.log("Final prize text:", prizeText);
                console.log("Final prize img:", prizeImg);

                setTimeout(() => {
                  // KHÃ”I PHá»¤C Láº I SWAL
                  window.Swal = originalSwal;

                  if (!window.Swal || !window.Swal.fire) {
                    console.error("SweetAlert2 khÃ´ng kháº£ dá»¥ng");
                    alert(`ChÃºc má»«ng! Báº¡n Ä‘Ã£ trÃºng: ${prizeText}`);
                    return;
                  }

                  // Xá»­ lÃ½ cÃ¡c trÆ°á»ng há»£p
                  if (data == null || prizeText == null) {
                    originalSwal.fire({
                      title: 'ChÆ°Æ¡ng trÃ¬nh káº¿t thÃºc',
                      text: 'ÄÃ£ háº¿t pháº§n thÆ°á»Ÿng',
                      icon: 'error',
                      confirmButtonText: 'ÄÃ³ng',
                      backdrop: false,
                      allowOutsideClick: false
                    });
                  } else if (prizeText === 'ChÃ o má»«ng báº¡n Ä‘áº¿n vá»›i ITC' || prizeText.includes('may máº¯n')) {
                    originalSwal.fire({
                      title: 'CHÃ€O Má»ªNG',
                      text: 'TÃ¢n sinh viÃªn ITC KhÃ³a 25',
                      imageUrl: prizeImg || './images/hengaplai.png',
                      imageWidth: 100,
                      imageHeight: 100,
                      confirmButtonText: 'OK',
                      backdrop: false,
                      allowOutsideClick: false,
                      customClass: {
                        popup: 'simple-swal-popup',
                        confirmButton: 'simple-swal-button'
                      },
                      imageAlt: 'Logo ITC'
                    }).catch(err => {
                      console.error("Lá»—i hiá»ƒn thá»‹ popup:", err);
                    });
                  } else {
                    let displayImg = prizeImg || './images/logo.png';

                    originalSwal.fire({
                      title: 'ChÃºc má»«ng!',
                      text: `Báº¡n Ä‘Ã£ trÃºng: ${prizeText}`,
                      imageUrl: displayImg,
                      imageWidth: 120,
                      confirmButtonText: 'OK',
                      backdrop: false,
                      allowOutsideClick: false,
                      customClass: {
                        popup: 'simple-swal-popup',
                        confirmButton: 'simple-swal-button'
                      },
                      imageAlt: prizeText
                    }).catch(err => {
                      console.error("Lá»—i hiá»ƒn thá»‹ popup:", err);
                    });
                  }
                }, 100);
              }
            });
          },
          false
        );

        function randomIndex(prizes) {
          if (!isPercentage) {
            return Math.floor(Math.random() * prizes.length);
          }

          let rand = Math.random();
          let cumulativeProbability = 0;

          console.log("ðŸŽ² Random value:", rand.toFixed(4));

          for (let i = 0; i < prizes.length; i++) {
            cumulativeProbability += prizes[i].percentpage;
            console.log(`  Index ${i}: cumulative = ${cumulativeProbability.toFixed(4)}`);

            if (rand < cumulativeProbability) {
              console.log(`âœ… Selected: Index ${i} - ${prizes[i].text}`);
              return i;
            }
          }

          console.warn("âš ï¸ Fallback to last prize");
          return prizes.length - 1;
        }

      </script>
    </div>
  </div>
</body>

</html>